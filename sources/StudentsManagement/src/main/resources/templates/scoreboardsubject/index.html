<!DOCTYPE html>
<html layout:decorate="~{layouts/default-layout}" xmlns:layout="http://www.w3.org/1999/xhtml">

<head>
    <title>Scoreboard-Subject</title>
</head>

<body>
<div layout:fragment="content" class="page-wrapper">
    <div>
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon.png"/>
        <link href="/assets/libs/flot/css/float-chart.css" rel="stylesheet"/>
        <link href="/dist/css/style.min.css" rel="stylesheet"/>
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon.png"/>
        <link rel="stylesheet" type="text/css" href="/assets/extra-libs/multicheck/multicheck.css"/>
        <link href="/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet"/>
        <link href="/dist/css/style.min.css" rel="stylesheet"/>
        <link rel="stylesheet" type="text/css" href="/assets/libs/select2/dist/css/select2.min.css"/>
        <link rel="stylesheet" type="text/css" href="/assets/libs/jquery-minicolors/jquery.minicolors.css"/>
        <link rel="stylesheet" type="text/css"
              href="/assets/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css"/>
        <link rel="stylesheet" type="text/css" href="/assets/libs/quill/dist/quill.snow.css"/>
        <link href="/dist/css/style.min.css" rel="stylesheet"/>
        <link href="/assets/libs/toastr/build/toastr.min.css" rel="stylesheet"/>
    </div>
    <style>
        ul {
            list-style-type: none;
            padding: 0;
            margin-top: 10px;
            z-index: 20;
        }

        li {
            padding: 5px;
            cursor: pointer;
        }

        li:hover {
            background-color: #f4f4f4;
        }

        .modal-dialog {
            max-width: 80%;
        }

        .close {
            border: none;
        }

        .close:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }

        .go-to input[type=number]::-webkit-inner-spin-button,
        .go-to input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
        }

        .go-to input[type=number] {
            -moz-appearance: textfield;
        }
    </style>

    <div class="row">
        <div class="col-md-12">
            <div class="card" style="margin-bottom: 0;">
                <form class="form-horizontal">
                    <div class="card-body">
                        <h4 class="card-title">SEARCH INFOMATION</h4>
                        <div class="row">
                            <div class="col-md-6 form-group row">
                                <label for="fclass"
                                       class="col-sm-3 text-end control-label col-form-label">Class</label>
                                <div class="col-sm-9 class-input">
                                    <select name="class" id="fclass" class="form-control">
                                        <option selected>All</option>
                                        <option th:each="c : ${class}" th:value="${c.id}" th:text="${c.name}"></option>
                                    </select>
                                    <!--										<input type="text" class="input-url form-control" id="fclass" name="classroom"-->
                                    <!--											placeholder="Class room" />-->
                                </div>
                            </div>
                            <div class="col-md-6 form-group row">
                                <label for="fsubject"
                                       class="col-sm-3 text-end control-label col-form-label">Subject</label>
                                <div class="col-sm-9 subject-input">
                                    <select name="subject" id="fsubject" class="form-control">
                                        <option selected>All</option>
                                        <option th:each="s : ${subject}" th:value="${s.id}"
                                                th:text="${s.name}"></option>
                                    </select>
                                    <!--										<input type="text" class="input-url form-control" id="fname" name="subject"-->
                                    <!--											placeholder="Subject name" />-->
                                </div>
                            </div>
                            <div class="col-md-6 form-group row">
                                <label for="fstudent"
                                       class="col-sm-3 text-end control-label col-form-label">Student</label>
                                <div class="col-sm-9">
                                    <input type="text" class="input-url form-control" id="fstudent" name="student"
                                           placeholder="Student name"/>
                                </div>
                            </div>
                            <div class="col-md-6 form-group row">
                                <label for="fyear"
                                       class="col-sm-3 text-end control-label col-form-label">Year</label>
                                <div class="col-sm-9 year-input">
                                    <select name="year" id="fyear" class="form-control">
                                        <option th:each="y : ${year}" th:value="${y}" th:text="${y}"
                                                th:selected="${y == defaultYear}"></option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6 form-group row">
                                <label for="fsemester"
                                       class="col-sm-3 text-end control-label col-form-label">Semester</label>
                                <div class="col-sm-9 semester-input">
                                    <select name="semester" id="fsemester" class="form-control">
                                        <option th:each="s : ${#numbers.sequence(1,2)}" th:value="${s}" th:text="${s}"
                                                th:selected="${s == 1}"></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="card-body" style="padding: 0 20px;">
                    <button type="button" class="btn btn-primary btn-search">
                        Search
                    </button>
                    <button type="submit" class="btn btn-primary btn-add">
                        Add
                    </button>
                    <button type="submit" class="btn btn-primary btn-edit">Edit</button>
                    <button type="submit" class="btn btn-primary btn-delete">Delete</button>
                    <button type="submit" class="btn btn-primary btn-import">
                        Import (Excel)
                    </button>
                    <button type="submit" class="btn btn-primary btn-export">
                        Export (Excel)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table id="zero_config" class="table table-striped table-bordered">
                    <thead class="thead-light">
                    <tr>
                        <th>
                            <label class="customcheckbox mb-3">
                                <input type="checkbox" id="mainCheckbox"/>
                                <span class="checkmark"></span>
                            </label>
                        </th>
                        <th>Student ID</th>
                        <th>Student Name</th>
                        <th>15 Mins Score</th>
                        <th>45 Mins Score</th>
                        <th>Mid-exam Score</th>
                        <th>Final-exam Score</th>
                        <th>Average Score</th>
                        <th>Passed</th>
                    </tr>
                    </thead>
                    <tbody class="customtable">
                    <tr th:each="scoreboard: ${res.listT}">
                        <th>
                            <label class="customcheckbox">
                                <input type="checkbox" th:name="${scoreboard.id}" class="listCheckbox"/>
                                <span class="checkmark"></span>
                            </label>
                        </th>
                        <td th:text="${scoreboard?.student?.id}"/>
                        <td th:text="${scoreboard?.student?.name}"/>
                        <td th:text="${scoreboard?.exam15Min}"/>
                        <td th:text="${scoreboard?.exam45Min}"/>
                        <td th:text="${scoreboard?.examMiddle}"/>
                        <td th:text="${scoreboard?.examFinal}"/>
                        <td th:text="${scoreboard?.averageScore}"/>
                        <td th:text="${scoreboard.isCompleted}"/>
                    </tr>
                    </tbody>
                </table>
                <div style="display: flex; justify-content: right; align-items: center;">
                    <div class="total-rows">
                        <select class="custom-select custom-select-lg mb-3"
                                style="margin: 0 !important; padding: 4px 6px;">
                            <option th:selected="${res.perPage} == 10" value="10">10</option>
                            <option th:selected="${res.perPage} == 15" value="15">15</option>
                            <option th:selected="${res.perPage} == 20" value="20">20</option>
                            <option th:selected="${res.perPage} == 30" value="30">30</option>
                            <option th:selected="${res.perPage} == 40" value="40">40</option>
                            <option th:selected="${res.perPage} == 70" value="70">70</option>
                            <option th:selected="${res.perPage} == 100" value="100">100</option>
                        </select>
                    </div>
                    <ul id="pagination-demo" class="pagination-sm" style="margin-bottom:0;"></ul>
                    <div><span th:text="${res.currentPage}"></span>/<span th:text="${res.totalPages}"></span></div>
                    <div class="go-to"
                         style="display: flex; justify-content: right; align-items: center; margin: 0 4px;">
                        <input class="form-control form-control-sm" type="number" style="width: 35px;">
                        <button class="btn btn-primary">Go</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modelAdd" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ADD SCOREBOARD</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 form-group row">
                            <label for="fname"
                                   class="col-sm-3 text-end control-label col-form-label">Student</label>
                            <div class="col-sm-9" style="position: relative;">
                                <input type="text" id="studentSearch" class="form-control" placeholder="">
                                <input type="text" id="studentId" name="studentId" hidden class="form-control"
                                       placeholder="">
                                <ul style="position: absolute; top: 100%; left: 10px; right: 10px; background-color: #ccc;"
                                    id="studentResults"></ul>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Class</label>
                            <div class="col-sm-9" style="position: relative;">
                                <input type="text" id="classSearch" class="form-control" placeholder="">
                                <input type="text" id="classId" name="classId" hidden class="form-control"
                                       placeholder="">
                                <ul style="position: absolute; top: 100%; left: 10px; right: 10px; background-color: #ccc;"
                                    id="classResults"></ul>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname"
                                   class="col-sm-3 text-end control-label col-form-label">Subject</label>
                            <div class="col-sm-9" style="position: relative;">
                                <input type="text" id="subjectSearch" class="form-control" placeholder="">
                                <input type="text" id="subjectId" name="subjectId" hidden class="form-control"
                                       placeholder="">
                                <ul style="position: absolute; top: 100%; left: 10px; right: 10px; background-color: #ccc;"
                                    id="subjectResults"></ul>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">15 mins
                                score</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="score15mins"
                                       placeholder="15 mins socre"/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">45 mins
                                score</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="score45mins"
                                       placeholder="45 mins score"/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Mid-exam
                                score</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="mid_exam_score"
                                       placeholder="Mid-exam score"/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Final-exam
                                score</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="final_exam_score"
                                       placeholder="Final-exam score"/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname"
                                   class="col-sm-3 text-end control-label col-form-label">Semester</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="semester"
                                       placeholder="Semester"/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Year</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="year" placeholder="Year"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-cancel" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary btn-save">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modelEdit" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">EDIT SCOREBOARD</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <input type="number" class="form-control" id="fname" name="id" hidden placeholder=""/>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Name</label>
                            <div class="col-sm-9">
                                <input type="text" disabled class="form-control" id="fname" name="name"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Class</label>
                            <div class="col-sm-9">
                                <input type="text" disabled class="form-control" id="fname" name="classroom"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname"
                                   class="col-sm-3 text-end control-label col-form-label">Subject</label>
                            <div class="col-sm-9">
                                <input type="text" disabled class="form-control" id="fname" name="subject"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Score 15
                                mins</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="score15mins"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Score 45
                                mins</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="score45mins"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Score middle
                                exam</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="mid_exam_score"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Score final
                                exam</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="final_exam_score"
                                       placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname"
                                   class="col-sm-3 text-end control-label col-form-label">Semester</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="semester" placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="fname" class="col-sm-3 text-end control-label col-form-label">Year</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="fname" name="year" placeholder=""/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="lname" class="col-sm-3 text-end control-label col-form-label">Created
                                date</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="lname" name="createdDate" placeholder=""
                                       disabled/>
                            </div>
                        </div>
                        <div class="col-md-6 form-group row">
                            <label for="email1" class="col-sm-3 text-end control-label col-form-label">Updated
                                date</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="email1" name="updatedDate"
                                       placeholder="" disabled/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-cancel" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary btn-save">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modelDelete" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">DELETE CONFIRM</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    Do you want to delete this selected data, If you confirm this data can not restore !!!
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger btn-save">Confirm</button>
                    <button type="button" class="btn btn-success btn-cancel" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modelImport" class="modal fade" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">IMPORT EXCEL</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" name="fileImport" id="validatedCustomFile"
                               accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                               required/>
                        <label class="custom-file-label" for="validatedCustomFile"></label>
                        <div class="invalid-feedback">
                            Example invalid custom file feedback
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-cancel" data-dismiss="modal">Cancel</button>
                    <a href="/student/export-example" target="_blank">
                        <button type="button" class="btn btn-primary " data-dismiss="modal">Download example
                            file
                        </button>
                    </a>
                    <button type="button" class="btn btn-primary btn-save">Save</button>
                </div>
            </div>
        </div>
    </div>

    <div>

        <script src="/assets/libs/jquery/dist/jquery.min.js"></script>
        <script src="/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js"></script>
        <script src="/assets/extra-libs/sparkline/sparkline.js"></script>
        <script src="/dist/js/waves.js"></script>
        <script src="/dist/js/sidebarmenu.js"></script>
        <script src="/dist/js/custom.min.js"></script>
        <script src="/assets/libs/flot/excanvas.js"></script>
        <script src="/assets/libs/flot/jquery.flot.js"></script>
        <script src="/assets/libs/flot/jquery.flot.pie.js"></script>
        <script src="/assets/libs/flot/jquery.flot.time.js"></script>
        <script src="/assets/libs/flot/jquery.flot.stack.js"></script>
        <script src="/assets/libs/flot/jquery.flot.crosshair.js"></script>
        <script src="/assets/libs/flot.tooltip/js/jquery.flot.tooltip.min.js"></script>
        <script src="/dist/js/pages/chart/chart-page-init.js"></script>

        <!-- this page js -->
        <script src="/assets/extra-libs/multicheck/datatable-checkbox-init.js"></script>
        <script src="/assets/extra-libs/multicheck/jquery.multicheck.js"></script>
        <script src="/assets/extra-libs/DataTables/datatables.min.js"></script>
        <script src="/assets/libs/toastr/build/toastr.min.js"></script>

        <script
                src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.min.js"></script>
        <script th:inline="javascript">
            const res = /*[[${res}]]*/ '';
            $('#pagination-demo').twbsPagination({
                totalPages: res?.totalPages || 1,
                visiblePages: 5,
                startPage: res?.currentPage > res?.totalPages ? res?.totalPages : res?.currentPage || 1,
                next: 'Next',
                prev: 'Prev',
                onPageClick: function (event, page) {
                    const pageTo = page;
                    const currentUrl = window.location.href;
                    const url = new URL(currentUrl);
                    const prePage = url.searchParams.get("currentPage") || 1;
                    url.searchParams.set("currentPage", pageTo)
                    const newUrl = url.href;
                    window.history.pushState({path: newUrl}, '', newUrl);
                    if (prePage != pageTo) {
                        location.reload();
                    }
                },
            });
            $("div.total-rows select").change((a) => {
                const perPageTo = $("div.total-rows option:selected").text();

                const currentUrl = window.location.href;
                const url = new URL(currentUrl);
                url.searchParams.set("perPage", perPageTo);
                const newUrl = url.href;
                window.history.pushState({path: newUrl}, '', newUrl);
                location.reload();
            });
            $(".go-to .btn").click(() => {
                const pageTo = $(".go-to input").val();

                const currentUrl = window.location.href;
                const url = new URL(currentUrl);
                url.searchParams.set("currentPage", pageTo)
                const newUrl = url.href;
                window.history.pushState({path: newUrl}, '', newUrl);
                location.reload();
            })

            /****************************************
             *       Basic Table                   *
             ****************************************/
            // const table = $("#zero_config").DataTable();

        </script>
        <script>
            $(document).ready(function () {

                // $('.input-url').on('change', function () {
                // 	const name = $(this).attr("name");
                // 	const value = $(this).val();
                // 	const currentUrl = window.location.href;
                // 	const url = new URL(currentUrl);
                // 	const scoreBoard = url.searchParams.get("scoreBoard") ? JSON.parse(url.searchParams.get("user")) : {};
                // 	url.searchParams.set("scoreBoard", JSON.stringify({...scoreBoard, [name]: value}));
                // 	const newUrl = url.href;
                // 	window.history.pushState({path: newUrl}, '', newUrl);
                // });
                const currentUrl = window.location.href;
                const url = new URL(currentUrl);
                const urlParams = new URLSearchParams(url.search);
                const params = Object.fromEntries(urlParams);
                const scoreBoard = JSON.parse(params?.scoreBoard || "{}");
                for (const name in scoreBoard) {
                    if (Object.hasOwnProperty.call(params, name)) {
                        const value = scoreBoard[name];
                        $(`.input-url[name=${name}]`).val(value)
                    }
                }
            })

            $(document).ready(function () {
                $(".btn-search").click(function () {
                    const currentUrl = window.location.href;
                    const url = new URL(currentUrl);
                    let scoreboard = {};
                    if ($("#fclass").val()?.toLowerCase() !== "all") {
                        url.searchParams.set("scoreboard", JSON.stringify({...scoreboard, "classs": parseInt($("#fclass").val())}))
                        scoreboard = JSON.parse(url.searchParams.get("scoreboard"));
                    }
                    if ($("#fstudent").val()) {
                        url.searchParams.set("scoreboard", JSON.stringify({...scoreboard, "student": parseInt($("#fstudent").val())}));
                        scoreboard = JSON.parse(url.searchParams.get("scoreboard"));
                    }
                    if ($("#fsubject").val()?.toLowerCase() !== "all") {
                        url.searchParams.set("scoreboard", JSON.stringify({...scoreboard, "subject": parseInt($("#fsubject").val())}));
                        scoreboard = JSON.parse(url.searchParams.get("scoreboard"));
                    }
                    url.searchParams.set("scoreboard", JSON.stringify({...scoreboard, "year": parseInt($("#fyear").val())}));
                    scoreboard = JSON.parse(url.searchParams.get("scoreboard"));
                    url.searchParams.set("scoreboard", JSON.stringify({...scoreboard, "semester": parseInt($("#fsemester").val())}));
                    const newUrl = url.href;
                    window.history.pushState({path: newUrl}, '', newUrl);
                    location.reload();
                    toastr.success("Search successfully!!", "System Says");
                });
            });
            $(document).ready(function () {
                $(".btn-add").click(function () {
                    $("#modelAdd").modal('show');
                });
                $('#modelAdd').on('hidden.bs.modal', function () {
                    $("#modelAdd input[name='name']").val("");
                });
                $("#modelAdd .btn-save").click(function () {
                    //handle add
                    const scoreboard = {}
                    scoreboard.id = null;
                    scoreboard["student.id"] = Number.parseInt($("#modelAdd input[name='studentId']").val());
                    scoreboard["classs.id"] = Number.parseInt($("#modelAdd input[name='classId']").val());
                    scoreboard["subject.id"] = Number.parseInt($("#modelAdd input[name='subjectId']").val());
                    scoreboard.exam15Min = Number.parseFloat($("#modelAdd input[name='score15mins']").val()) || null;
                    scoreboard.exam45Min = Number.parseFloat($("#modelAdd input[name='score45mins']").val()) || null;
                    scoreboard.examMiddle = Number.parseFloat($("#modelAdd input[name='mid_exam_score']").val()) || null;
                    scoreboard.examFinal = Number.parseFloat($("#modelAdd input[name='final_exam_score']").val()) || null;
                    scoreboard.semester = Number.parseInt($("#modelAdd input[name='semester']").val());
                    scoreboard.year = Number.parseInt($("#modelAdd input[name='year']").val());
                    console.log(scoreboard);
                    $.ajax({
                        type: "POST",
                        url: "/scoreboard-subject",
                        data: scoreboard,
                        success: (added, message, obj) => {
                            if (added) {
                                location.reload();
                            } else {
                                toastr.error("Error system admin. Try later.", "System Says");
                            }
                        },
                        error: () => {
                            toastr.error("Error system admin. Try later.", "System Says");
                        },
                    });
                    $("#modelAdd").modal('hide')
                })
            });
            $(document).ready(function () {
                $(".btn-edit").click(function () {
                    const ids = $("#zero_config input:checked:not(#mainCheckbox)").map((index, item) => Number.parseInt(item.getAttribute("name"))).toArray();
                    if (ids.length == 0) {
                        toastr.warning("You have to select one item to edit.", "System Says");
                        return
                    } else if (ids.length > 1) {
                        toastr.warning("You have to select one item to edit.", "System Says");
                        return
                    }
                    $.ajax({
                        type: "GET",
                        url: `/scoreboard-subject/${ids[0]}`,
                        success: (scoreboard, message, obj) => {
                            if (scoreboard) {
                                $("#modelEdit").modal('show')
                                $("#modelEdit input[name=id]").val(scoreboard?.id)
                                $("#modelEdit input[name=name]").val(scoreboard?.student?.name)
                                $("#modelEdit input[name=classroom]").val(scoreboard?.classs?.name)
                                $("#modelEdit input[name=subject]").val(scoreboard?.subject?.name)
                                $("#modelEdit input[name=score15mins]").val(scoreboard?.exam15Min)
                                $("#modelEdit input[name=score45mins]").val(scoreboard?.exam45Min)
                                $("#modelEdit input[name=mid_exam_score]").val(scoreboard?.examMiddle)
                                $("#modelEdit input[name=final_exam_score]").val(scoreboard?.examFinal)
                                $("#modelEdit input[name=semester]").val(scoreboard?.semester)
                                $("#modelEdit input[name=year]").val(scoreboard?.year)
                                $("#modelEdit input[name=createdDate]").val(new Date(scoreboard?.createdDate).toLocaleString())
                                $("#modelEdit input[name=updatedDate]").val(new Date(scoreboard?.createdDate).toLocaleString())
                            } else {
                                toastr.error("Error system admin. Try later.", "System Says");
                            }
                        },
                        error: () => {
                            toastr.error("Error system admin. Try later.", "System Says");
                        },
                    });
                });
                $("#modelEdit .btn-save").click(function () {
                    //handle edit
                    $("#modelEdit").modal('hide')
                    toastr.success("Edit successfully!!", "System Says");
                    const scoreboard = {}
                    scoreboard.id = Number.parseInt($("#modelEdit input[name='id']").val())
                    scoreboard.exam15Min = Number.parseFloat($("#modelEdit input[name='score15mins']").val()) || null;
                    scoreboard.exam45Min = Number.parseFloat($("#modelEdit input[name='score45mins']").val()) || null;
                    scoreboard.examMiddle = Number.parseFloat($("#modelEdit input[name='mid_exam_score']").val()) || null;
                    scoreboard.examFinal = Number.parseFloat($("#modelEdit input[name='final_exam_score']").val()) || null;
                    scoreboard.semester = Number.parseInt($("#modelEdit input[name='semester']").val()) || null;
                    scoreboard.year = Number.parseInt($("#modelEdit input[name='year']").val()) || null;
                    debugger
                    $.ajax({
                        type: "PATCH",
                        url: "/scoreboard-subject",
                        data: scoreboard,
                        success: (updated, message, obj) => {
                            if (updated) {
                                location.reload();
                            } else {
                                toastr.error("Error system admin. Try later.", "System Says");
                            }
                        },
                        error: () => {
                            toastr.error("Error system admin. Try later.", "System Says");
                        },
                    });
                })
                $(".btn-delete").click(function () {
                    const ids = $("#zero_config input:checked:not(#mainCheckbox)");
                    if (ids.length == 0) {
                        toastr.warning("You have to select one item to edit.", "System Says");
                        return
                    }
                    $("#modelDelete").modal('show');
                });
                $("#modelDelete .btn-save").click(function () {
                    //handle delete
                    const ids = $("#zero_config input:checked:not(#mainCheckbox)").map((index, item) => Number.parseInt(item.getAttribute("name"))).toArray();
                    $.ajax({
                        type: "DELETE",
                        url: "/scoreboard-subject",
                        data: {
                            ids: ids,
                            redirectUrl: window.location.href
                        },
                        success: (deleted, message, obj) => {
                            if (deleted) {
                                location.reload();
                            } else {
                                toastr.error("Error system admin. Try later.", "System Says");
                            }
                        },
                        error: () => {
                            toastr.error("Error system admin. Try later.", "System Says");
                        },
                    });
                    $("#modelDelete").modal('hide')
                })
            });

            $(document).ready(function () {
                $(".btn-import").click(function () {
                    //handle import
                    $("#modelImport").modal('show');
                });
                $('#modelImport').on('hidden.bs.modal', function () {
                    $("#modelImport input[name='fileImport']").val("");
                });
                $("#modelImport .btn-save").click(function () {
                    const file = $("#modelImport input[name='fileImport']").prop('files');
                    if (file?.length != 1) {
                        toastr.warning("You must select only one file.", "System Says");
                        return;
                    }
                    const data = new FormData();
                    data.append("file", file[0])
                    $.ajax({
                        type: 'POST',
                        method: 'POST',
                        url: "student/import",
                        data: data,
                        processData: false,
                        cache: false,
                        contentType: false,
                        success: function (res) {
                            window.location.reload();
                        },
                        error: () => {
                            toastr.error("Error system admin. Try later.", "System Says");
                        }
                    });
                    $("#modelImport").modal('hide')
                })

                $(".btn-export").click(function () {
                    const currentUrl = window.location.href;
                    const url = new URL(currentUrl);
                    let endpoint = '/scoreboard-subject/export';
                    if (url.searchParams.get("scoreboard")) {
                        endpoint += "?scoreboard=" + convertSpecialCharacter(url.searchParams.get("scoreboard"));
                    }
                    var win = window.open(endpoint, '_blank');
                    if (win) {
                        //Browser has allowed it to be opened
                        win.focus();
                    } else {
                        //Browser has not allowed it to be opened
                        toastr.warning("Please allow popups for this website.", "System Says");
                    }
                });

                function convertSpecialCharacter(val) {
                    return val.replace(/[&\/\\#,+()$~.%'":*?<>{}!^]/g, (char) =>
                        '%' + char.charCodeAt(0).toString(16));
                }
            });

            $(document).ready(function () {
                $(".close").click(function () {
                    $(".modal").modal('hide');
                });
            });

            $(document).ready(function () {
                $(".btn-cancel").click(function () {
                    $(".modal").modal('hide');
                });
            });
        </script>
        <!-- This Page JS -->
        <script src="/assets/libs/inputmask/dist/min/jquery.inputmask.bundle.min.js"></script>
        <script src="/dist/js/pages/mask/mask.init.js"></script>
        <script src="/assets/libs/select2/dist/js/select2.full.min.js"></script>
        <script src="/assets/libs/select2/dist/js/select2.min.js"></script>
        <script src="/assets/libs/jquery-asColor/dist/jquery-asColor.min.js"></script>
        <script src="/assets/libs/jquery-asGradient/dist/jquery-asGradient.js"></script>
        <script src="/assets/libs/jquery-asColorPicker/dist/jquery-asColorPicker.min.js"></script>
        <script src="/assets/libs/jquery-minicolors/jquery.minicolors.min.js"></script>
        <script src="/assets/libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script src="/assets/libs/quill/dist/quill.min.js"></script>


        <script>
            //***********************************//
            // For select 2
            //***********************************//
            $(".select2").select2();

            /*colorpicker*/
            $(".demo").each(function () {
                //
                // Dear reader, it's actually very easy to initialize MiniColors. For example:
                //
                //  $(selector).minicolors();
                //
                // The way I've done it below is just for the demo, so don't get confused
                // by it. Also, data- attributes aren't supported at this time...they're
                // only used for this demo.
                //
                $(this).minicolors({
                    control: $(this).attr("data-control") || "hue",
                    position: $(this).attr("data-position") || "bottom left",

                    change: function (value, opacity) {
                        if (!value) return;
                        if (opacity) value += ", " + opacity;
                        if (typeof console === "object") {
                            console.log(value);
                        }
                    },
                    theme: "bootstrap",
                });
            });
            /*datwpicker*/
            jQuery(".mydatepicker").datepicker();
            jQuery("#datepicker-autoclose").datepicker({
                autoclose: true,
                todayHighlight: true,
            });
            jQuery("#datepicker-autoclose-2").datepicker({
                autoclose: true,
                todayHighlight: true,
            });
            // var quill = new Quill("#editor", {
            //   theme: "snow",
            // });
        </script>
        <script>
            const studentSearch = document.getElementById('studentSearch');
            const studentResults = document.getElementById('studentResults');
            let timeoutStudentId;
            studentSearch.addEventListener('input', handleStudentInput);

            function handleStudentInput() {
                clearTimeout(timeoutStudentId);
                const searchValue = studentSearch.value;
                // Clear previous results
                studentResults.innerHTML = '';
                // Debounce API call
                timeoutStudentId = setTimeout(() => {
                    // Call API to get autocomplete results
                    const query = `id=${Number.parseInt(searchValue) || 0}&name=${searchValue}&email=${searchValue}&currentPage=${1}`;
                    fetch(`/student/search?${query}`)
                        .then(response => response.json())
                        .then(data => {
                            displayStudentResults(data.listT);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }, 500); // Delay in milliseconds
            }

            function displayStudentResults(results) {
                studentResults.innerHTML = ''
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.innerText = `${result.id}-${result.name}`;
                    li.addEventListener('click', () => {
                        studentSearch.value = li.innerText;
                        $('#modelAdd #studentId').val(result.id);
                        studentResults.innerHTML = '';
                    });
                    studentResults.appendChild(li);
                });
            }

            document.addEventListener("click", function (e) {
                studentResults.innerHTML = '';
            });
        </script>
        <script>
            const classSearch = document.getElementById('classSearch');
            const classResults = document.getElementById('classResults');
            let timeoutClassId;
            classSearch.addEventListener('input', handleClassInput);

            function handleClassInput() {
                clearTimeout(timeoutClassId);
                const searchValue = classSearch.value;
                // Clear previous results
                classResults.innerHTML = '';
                // Debounce API call
                timeoutClassId = setTimeout(() => {
                    // Call API to get autocomplete results
                    const query = `id=${Number.parseInt(searchValue) || 0}&name=${searchValue}&year=${searchValue}&currentPage=${1}`;
                    fetch(`/class/search?${query}`)
                        .then(response => response.json())
                        .then(data => {
                            displayClassResults(data.listT);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }, 500); // Delay in milliseconds
            }

            function displayClassResults(results) {
                classResults.innerHTML = ''
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.innerText = `${result.id}-${result.name}`;
                    li.addEventListener('click', () => {
                        classSearch.value = li.innerText;
                        $('#modelAdd #classId').val(result.id);
                        classResults.innerHTML = '';
                    });
                    classResults.appendChild(li);
                });
            }

            document.addEventListener("click", function (e) {
                classResults.innerHTML = '';
            });
        </script>
        <script>
            const subjectSearch = document.getElementById('subjectSearch');
            const subjectResults = document.getElementById('subjectResults');
            let timeoutSubjectId;
            subjectSearch.addEventListener('input', handleSubjectInput);

            function handleSubjectInput() {
                clearTimeout(timeoutSubjectId);
                const searchValue = subjectSearch.value;
                // Clear previous results
                subjectResults.innerHTML = '';
                // Debounce API call
                timeoutSubjectId = setTimeout(() => {
                    // Call API to get autocomplete results
                    const query = `id=${Number.parseInt(searchValue) || 0}&name=${searchValue}&currentPage=${1}`;
                    fetch(`/subject/search?${query}`)
                        .then(response => response.json())
                        .then(data => {
                            displaySubjectResults(data.listT);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }, 500); // Delay in milliseconds
            }

            function displaySubjectResults(results) {
                subjectResults.innerHTML = ''
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.innerText = `${result.id}-${result.name}`;
                    li.addEventListener('click', () => {
                        subjectSearch.value = li.innerText;
                        $('#modelAdd #subjectId').val(result.id);
                        subjectResults.innerHTML = '';
                    });
                    subjectResults.appendChild(li);
                });
            }

            document.addEventListener("click", function (e) {
                subjectResults.innerHTML = '';
            });
        </script>
    </div>
</div>

</body>

</html>